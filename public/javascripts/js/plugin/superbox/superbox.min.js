!function (a) {
    a.fn.SuperBox = function (b) {
        var c = a('<div class="superbox-show"></div>'),
            d = a('<div class="superbox-current-img"><iframe id="frame" src=""/></div><div id="imgInfoBox" class="superbox-imageinfo inline-block"> ' +
                '<h1 style="display:inline">Title</h1>' +
                '<ul class="demo-btns" style="display:inline; margin-left:15px"><a href="#a" class="rName-edit"><span class="glyphicon glyphicon-wrench" style="font-size:17px"></span> </a> </ul><br/>' +
                '<div id="machineDiv"><h4><strong>기기 정보</strong></h4>' +
                '<p><span class="mName" style="margin-right:30px; padding: 0px;"></span><span class="ip" style="padding: 0px;"></span></p>' +
                '<p><span class="mac"  style="padding: 0px"></span></p><br/></div>' +
                '<h4><strong>고인 정보</strong></h4>' +
                '<p><span class="name" style="margin-right:20px; padding: 0px;"></span> <span class="gender" style="margin-right:20px; padding: 0px;"></span> ' +
                '<span class="age" style="margin-right:20px; padding: 0px;"></span> <span class="religionPosition" style="padding: 0px;"></span></p>' +
                '<p><span class="ipgwan" style="margin-right:30px; padding: 0px;"></span><span class="barin" style="padding: 0px;"></span></p>' +
                '<p><span class="jangji" style="padding: 0px"></span></p>' +
                //'<p><span class="funeralService" style="margin-right:20px; padding: 0px;"></span><span class="baecha" style="margin-right:20px; padding: 0px;"></span>' +
                //'<span class="diagnosis" style="margin-right:10px; padding: 0px; font-weight:bold;">진단</span><span class="first" style="margin-right:10px; padding: 0px; font-weight:bold;">초도</span><span class="calculate" style="padding: 0px; font-weight:bold;">정산</span></p>' +
                '<span class="sangju"  style="padding: 0 0 10 0"></span><br>' +
                '<span class="invitation"  style="padding: 0 0 10 0"></span>' +
                '<p><a href="javascript:void(0);" class="btn btn-primary btn-sm newRoomBtn">새로 입력</a> ' +
                '<a href="javascript:void(0);" class="btn btn-success btn-sm editRoomBtn">수정</a> ' +
                '<a href="javascript:void(0);" class="btn btn-success btn-sm copyRoomBtn">복제</a> ' +
                '<a href="javascript:void(0);" class="btn btn-danger btn-sm endRoomBtn">종료</a> </p></span> </div>'),
            e = a('<div class="superbox-close txt-color-white"><i class="fa fa-times fa-lg"></i></div>');
        c.append(d).append(e);
        a(".superbox-imageinfo");
        return this.each(function () {
            a(".superbox-list").unbind("click").on("click",function () {
                $this = a(this);
                var b = $this.find(".superbox-img"), e = b.data("img"), g = e, h = b.attr("title") || "No Title";
                var mName = b.attr("mName"), mac = b.attr("mac"), ip = b.attr("ip");
                var name = b.attr("name"), gender = b.attr("gender"), age = b.attr("age");
                var religion = b.attr("religion"), religionPosition = b.attr("religionPosition");
                var ipgwan = b.attr("ipgwan"), barin = b.attr("barin"), jangji = b.attr("jangji");
                var diagnosis = b.attr("diagnosis"), first = b.attr("first"), calculate = b.attr("calculate");
                var funeralService = b.attr("funeralService"), baecha = b.attr("baecha");
                var sangju = b.attr("sangju");
                var rID = b.attr("rID");
                var gImage = b.attr("gImage");
                var religion = b.attr("religion");
                var frame = d.find("iframe");
                var gAllFont = b.attr("gAllFont");
                var uLevel = b.attr("uLevel");
                var rRelation = b.attr("rRelation");
                var rImageRelation = b.attr("rImageRelation");
                var invitation = b.attr("invitation");
                var gID = b.attr("gID");
                var gEnableLogo = b.attr("gEnableLogo");
                var textGender = "없음";
                switch (gender){
                    case "1":   textGender = "남성";  break;
                    case "2":   textGender = "여성";  break;
                    case "3":   textGender = "男性";  break;
                    case "4":   textGender = "女性";  break;
                }

                d.find("iframe").attr("src", e), a(".superbox-list").removeClass("active"), $this.addClass("active"),
                    d.find(">:first-child").text(h), 0 == a(".superbox-current-img").css("opacity") && a(".superbox-current-img").animate({"opacity": 1}),
                    a(this).next().hasClass("superbox-show") ? (c.is(":visible") && a(".superbox-list").removeClass("active"), c.toggle()) : (c.insertAfter(this).css("display", "block"), $this.addClass("active")),
                    a("html, body").animate({"scrollTop": b.offset().top}, "medium"),

                    //우측 고인 정보 value 할당.
                    d.find(".mName").html("<strong>장비명 :</strong> " + mName), d.find(".mac").html("<strong>mac주소 :</strong> " + mac), d.find(".ip").html("<strong>ip주소 :</strong> " + ip),
                    d.find(".name").html("<strong>고인명 :</strong> " + name), d.find(".gender").html("<strong>성별 :</strong> " + textGender), d.find(".age").html("<strong>나이 :</strong> " + age),
                    d.find(".religionPosition").html("<strong>종교 :</strong> " + religionPosition),
                    d.find(".sangju").html(sangju.replace(/\n/g, '<br>')),
                    d.find(".ipgwan").html("<strong>입관 :</strong> " + ipgwan.slice(0,-3)), d.find(".barin").html("<strong>발인 :</strong> " + barin.slice(0,-3)), d.find(".jangji").html("<strong>장지 :</strong> " + jangji);
                    if (gID != undefined){
                        d.find(".invitation").html("<strong>찾아오는길 URL :</strong> <a href='http://diostory.com:3000/invitation?gID=" + gID + "'>" + "http://diostory.com:3000/invitation?gID=" + gID);
                    }

                //d.find(".funeralService").html("<strong>상조회 :</strong> " + funeralService), d.find(".baecha").html("<strong>배차 :</strong> " + baecha);
                //if(diagnosis=="0"){ d.find(".diagnosis").css("color", "red");    }else if(diagnosis=="1"){ d.find(".diagnosis").css("color", "green");   }
                //if(first=="0"){ d.find(".first").css("color", "red");    }else if(first=="1"){ d.find(".first").css("color", "green");   }
                //if(calculate=="0"){ d.find(".calculate").css("color", "red");    }else if(calculate=="1"){ d.find(".calculate").css("color", "green");   }

                if(uLevel!="관리자"){
                    d.find("#machineDiv").css("display", "none");
                }

                //이벤트 중복되서 바인드 되는것 막기.
                a(".rName-edit").unbind("click");
                a(".newRoomBtn").unbind("click");
                a(".editRoomBtn").unbind("click");
                a(".copyRoomBtn").unbind("click");
                a(".endRoomBtn").unbind("click");

                //이벤트 바인드
                a(".rName-edit").on("click", function(){rNameChangeDialog(rID, d.find(">:first-child"))});
                a(".newRoomBtn").on("click", function(){ window.location.href = "/room/roomNew/" + rID + "/" + h; });
                a(".editRoomBtn").on("click", function () {window.location.href = "/room/roomEdit/" + rID + "/" + h; });
                a(".copyRoomBtn").on("click", function () {
                    selectRoomBox(rID, function(result){
                        if(result) {
                            var roomSelect = document.getElementById("roomSelect");
                            var roomVal = roomSelect.options[roomSelect.selectedIndex].value;
                            var copyType = document.getElementById("copyType");
                            var copyVal = copyType.options[copyType.selectedIndex].value;

                            if (roomVal != null && copyVal != null) {
                                updateReplicationRoom(rID, roomVal, copyVal);
                            }
                        }
                    });
                });
                a(".endRoomBtn").on("click", function () {
                    endRoomConfirm(function(){
                        insertEmptyGuest(rID);
                    });
                });

                if(!name.length > 0) {
                    a(".editRoomBtn").attr("disabled", true);
                    a(".editRoomBtn").unbind("click");
                    a(".endRoomBtn").attr("disabled", true);
                    a(".endRoomBtn").unbind("click");
                }else{
                    if(rRelation.length > 0){ //복제타입이면
                        a(".editRoomBtn").attr("disabled", true);
                        a(".editRoomBtn").unbind("click");
                    }else if(rImageRelation.length > 0){
                        a(".editRoomBtn").attr("disabled", true);
                        a(".editRoomBtn").unbind("click");
                    }else{
                        a(".editRoomBtn").attr("disabled", false);
                    }
                    a(".endRoomBtn").attr("disabled", false);
                }

                //frame css 변경
                frame.css("width", "100%");
                frame.css("height", (frame.css("width").slice(0,-2) * 9 / 16).toFixed(2) );
                frame.css("border", 0);
                frame.css("background", "white");

                //frame 내부에 element 값 할당.
                frame.unbind("load");
                frame.load(function () {
                    if (frame.attr("src")=="stylesheets/img/blank_frame.jpg") {
                        $(this.contentDocument).find("img").css("width", "100%");
                        $(this.contentDocument).find("img").css("height", "100%");
                    }else {
                        frame.css("width", "100%");
                        var height = (frame.css("width").slice(0,-2) * 9 / 16).toFixed(2);
                        frame.css("height", height);
                    }

                    if (name.length>0) {
                        frame.prop("contentWindow").setName(name);
                        frame.prop("contentWindow").setGender(gender);
                        frame.prop("contentWindow").setReligionPosition(religionPosition);
                        frame.prop("contentWindow").setSangJu(sangju.replace(/\n|\r\n|\r/g, '<br>'));
                        frame.prop("contentWindow").setJangJi(jangji.replace(/\n|\r\n|\r/g, '<br>'));
                        frame.prop("contentWindow").setImage(gImage);
                        frame.prop("contentWindow").setReligion(religion);
                        frame.prop("contentWindow").setAge(age);
                        frame.prop("contentWindow").setRoomName(h);

                        frame.contents().find("*").css('font-family', gAllFont);

                        var date1 = new Date(getCrossBrowserDate(ipgwan)), date2 = new Date(getCrossBrowserDate(barin));
                        var ipgwanDate = date1.getFullYear() + "-" + ("0" + (date1.getMonth() + 1)).slice(-2) + "-" + date1.getDate();
                        var ipgwanTime = date1.getHours() + ":" + date1.getMinutes();
                        var barinDate = date2.getFullYear() + "-" + ("0" + (date2.getMonth() + 1)).slice(-2) + "-" + date2.getDate();
                        var barinTime = date2.getHours() + ":" + date2.getMinutes();

                        frame.prop("contentWindow").setIpgwanDate(ipgwanDate);
                        frame.prop("contentWindow").setIpgwanTime(ipgwanTime);
                        frame.prop("contentWindow").setBarinDate(barinDate);
                        frame.prop("contentWindow").setBarinTime(barinTime);

                        if(gEnableLogo=="1") {
                            frame.prop("contentWindow").setLogo("/upload/logo/" + $("#cImageHidden").val());
                        }
                    }
                });
            }), a(".superbox").unbind("click").on("click", ".superbox-close", function () {
                a(".superbox-list").removeClass("active"), a(".superbox-current-img").animate({"opacity": 0}, 200, function () {
                    a(".superbox-show").slideUp()
                })
            })
        })
    }
}(jQuery);